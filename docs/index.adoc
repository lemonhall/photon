# Photon



## Quickstart


## Streams


### Replay

Streams can be replayed using the Reactive Streams protocol.

```bash

> muon replay mystream
```

#### Partial Replay

### Special Stream

There are two special streams created by Photon to manage its internal state. You can replay data from these, and they
 are useful for creating backups of Photon state.

#### \\__config__

Photon internal configuration is stored in the //__config__ stream. Internally, this stream is played into a data structure
that represents the current Photon configuration.

The Photon API layer acts as a front on this stream.

#### \\__all__

The second special stream is //__all__. This contains all events, on all streams.

You can play this to obtain all events ever recieved by photon, in the order they were added in, no matter which stream, using
the global order_id.

## Projections

### Creating

### Querying

### Deleting



## Operations

### Installation

#### Running bare

TODO - update with released artifacts and download instructions.

#### Running in a Docker based system

This includes Docker itself and related projects (compose, machine etc), and also in systems that can use Docker containers,
such as Kubernetes, Mesos and the like.

Photon is published to an Artifactory backed Docker registry.

The coordinates for the image is `simplicityitself-muon-image.jfrog.io/photon:latest`

You can set the configuration options by altering the command line to be used.

You set the variable MUON_URL to the correct location for your system to enable Photon to connect to the Muon network.

This Docker Compose snippet shows how this can be done.


```yaml
    photon:
    image: simplicityitself-muon-image.jfrog.io/photon
    environment:
      - MUON_URL=amqp://muon:microservices@rabbitmq
    links:
      - rabbitmq
    ports:
      - "3000:3000"
    expose:
      - "3000"
    command: -jar target/photon.jar -rest.host 0.0.0.0
```

This updates photon to listen for HTTP traffic on all network interfaces.

### Backup

Photon is internally fully event sourced. All changes in internal state are mediated via one of the internal streams (denoted with \\__XX__)

You can perform a backup in one of two ways.

#### Copy backing data store

The backing data store (H2, Cassandra etc) contains all information necessary to back up the system. The data store, such as the
h2 db file, can be copied and archived to create a usable backup.

The contents of the backing data store are kept compatible over *minor* version updates only, and may not be compatible over major versions.

#### Stream based

The stream \\__all__ contains all of the configuration updates made over the lifetime of the system, along with all of the data
that it has persisted.

You can instruct photon to replay this stream in its entirety and persist this to disk. Once it has done so, you can
use that file to recreate a runtime clone of the original Photon.

This method is fully portable, and will be compatible over major version upgrades of Photon.

```bash
> muon replay __all__ >> /tmp/backup
```

This creates a log file that contains all events in the Photon.

To restore from this file

```bash
> cat /tmp/backup | muon event
```

### Monitoring

